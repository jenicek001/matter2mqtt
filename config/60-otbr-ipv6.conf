# OpenThread Border Router IPv6 Configuration
# Place this file in /etc/sysctl.d/60-otbr-ipv6.conf
#
# This configuration is REQUIRED for Thread Border Router to function properly.
# Apply with: sudo sysctl --system

# ============================================================================
# IPv6 Forwarding (REQUIRED)
# ============================================================================
# Enable IPv6 packet forwarding between interfaces
# This allows Thread devices to communicate with your network
net.ipv6.conf.all.forwarding = 1

# Enable IPv4 forwarding (needed for NAT64)
net.ipv4.ip_forward = 1

# ============================================================================
# Router Advertisement Processing (REQUIRED)
# ============================================================================
# Accept Router Advertisements even when forwarding is enabled
# This allows OTBR to learn IPv6 prefix from your router
net.ipv6.conf.all.accept_ra = 2

# Infrastructure interface - change 'eth0' to your network interface
# Use 'wlan0' for WiFi, 'eth0' for Ethernet
# To find your interface: ip link show
net.ipv6.conf.eth0.accept_ra = 2
net.ipv6.conf.eth0.accept_ra_rt_info_max_plen = 64

# Also configure for WiFi if you're using wireless
# Uncomment if using WiFi instead of/in addition to Ethernet:
# net.ipv6.conf.wlan0.accept_ra = 2
# net.ipv6.conf.wlan0.accept_ra_rt_info_max_plen = 64

# ============================================================================
# Thread Interface Configuration (wpan0)
# ============================================================================
# Disable autoconfiguration on Thread interface
# OTBR manages this interface, don't let the kernel interfere
net.ipv6.conf.wpan0.autoconf = 0
net.ipv6.conf.wpan0.accept_ra = 0

# ============================================================================
# Additional IPv6 Settings (Optional but Recommended)
# ============================================================================
# Increase neighbor table size for many Thread devices
net.ipv6.neigh.default.gc_thresh1 = 512
net.ipv6.neigh.default.gc_thresh2 = 2048
net.ipv6.neigh.default.gc_thresh3 = 4096

# Enable IPv6 route caching
net.ipv6.route.max_size = 16384

# ============================================================================
# NAT64 Support (Optional)
# ============================================================================
# Uncomment if you need Thread devices to reach IPv4-only services
# net.ipv6.conf.all.accept_ra_defrtr = 1
# net.ipv6.conf.all.accept_ra_pinfo = 1

# ============================================================================
# Security Considerations
# ============================================================================
# Log martian packets (packets with impossible addresses)
# Useful for debugging but can be noisy
# net.ipv4.conf.all.log_martians = 1

# Disable IPv6 ICMP redirects for security
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.all.send_redirects = 0

# ============================================================================
# Verification Commands
# ============================================================================
# After applying this file, verify with:
#   sysctl net.ipv6.conf.all.forwarding
#   sysctl net.ipv6.conf.eth0.accept_ra
#   sysctl net.ipv4.ip_forward
#
# View all IPv6 settings:
#   sysctl -a | grep ipv6
#
# Monitor OTBR routing:
#   ip -6 route show
#   ip -6 neigh show
